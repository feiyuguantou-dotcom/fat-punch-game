<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>èƒ–æå‰ç”·å‹ - è§£å‹å°æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow: hidden;
        }

        .game-container {
            max-width: 430px;
            margin: 0 auto;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* é¡µé¢åŸºç¡€æ ·å¼ */
        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.3s ease-out;
        }

        .page.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px) rotate(-2deg); }
            75% { transform: translateX(10px) rotate(2deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-100px); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes dizzy {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            25% { transform: translateX(-5px) rotate(-5deg); }
            75% { transform: translateX(5px) rotate(5deg); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes twinkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.3; transform: scale(0.8); }
        }

        /* é¦–é¡µæ ·å¼ */
        #home-page {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            align-items: center;
            justify-content: flex-start;
            padding: 0;
            position: relative;
            overflow: hidden;
        }

        /* é¦–é¡µèƒŒæ™¯è£…é¥° */
        .home-bg-decoration {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }

        .floating-star {
            position: absolute;
            font-size: 24px;
            animation: floatUp 3s ease-in-out infinite;
            opacity: 0.4;
            filter: drop-shadow(0 0 10px rgba(255,71,87,0.5));
        }

        /* é¦–é¡µå°é¢å®¹å™¨ */
        .hero-cover {
            width: 100%;
            height: 45vh;
            background: linear-gradient(180deg, rgba(255,87,87,0.15) 0%, rgba(255,71,87,0.08) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            flex-direction: column;
            padding: 20px;
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
        }

        /* æš´æ€’å¤´åƒ */
        .knocked-out-character {
            position: relative;
            width: 200px;
            height: 200px;
            animation: bounce 2s ease-in-out infinite;
        }

        .character-body {
            font-size: 0;
            position: relative;
            z-index: 2;
            filter: drop-shadow(0 15px 30px rgba(255,0,0,0.4));
        }

        .character-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            border: 5px solid rgba(255,71,87,0.5);
            box-shadow: 0 0 30px rgba(255,0,0,0.5);
        }

        /* æ„¤æ€’ç«ç„°ç‰¹æ•ˆ */
        .anger-flames {
            position: absolute;
            font-size: 35px;
            animation: flameFlicker 0.5s ease-in-out infinite alternate;
            z-index: 3;
        }

        @keyframes flameFlicker {
            0% { transform: scale(1) translateY(0); opacity: 0.8; }
            100% { transform: scale(1.1) translateY(-5px); opacity: 1; }
        }

        .swirl-effect {
            position: absolute;
            font-size: 40px;
            top: -20px;
            right: -10px;
            animation: spin 2s linear infinite;
            z-index: 3;
        }

        .stars-head {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 5px;
            z-index: 4;
        }

        .star {
            font-size: 28px;
            animation: twinkle 1s ease-in-out infinite;
        }

        .star:nth-child(2) {
            animation-delay: 0.3s;
        }

        .star:nth-child(3) {
            animation-delay: 0.6s;
        }

        /* æ‹³å°è£…é¥° */
        .fist-print {
            position: absolute;
            font-size: 30px;
            opacity: 0.7;
        }

        /* å¼¹çª—æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 25px;
            padding: 35px 30px;
            text-align: center;
            max-width: 320px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
            animation: modalPop 0.3s ease;
        }

        @keyframes modalPop {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .modal-emoji {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #FF6B9D;
            margin-bottom: 12px;
        }

        .modal-desc {
            font-size: 16px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .modal-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .modal-btn {
            padding: 14px 30px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn-primary {
            background: linear-gradient(135deg, #FF6B9D 0%, #FF4081 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255,107,157,0.4);
        }

        .modal-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,107,157,0.5);
        }

        .modal-btn-secondary {
            background: #f5f5f5;
            color: #666;
        }

        .modal-btn-secondary:hover {
            background: #e8e8e8;
        }

        .title-section {
            text-align: center;
            padding: 30px 20px;
            z-index: 1;
        }

        .game-title {
            font-size: 42px;
            font-weight: 900;
            color: #FF4757;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(255,71,87,0.8), 2px 2px 4px rgba(0,0,0,0.5);
            letter-spacing: 2px;
            animation: titlePulse 2s ease-in-out infinite;
        }

        @keyframes titlePulse {
            0%, 100% { text-shadow: 0 0 20px rgba(255,71,87,0.8), 2px 2px 4px rgba(0,0,0,0.5); }
            50% { text-shadow: 0 0 30px rgba(255,71,87,1), 2px 2px 4px rgba(0,0,0,0.5); }
        }

        .game-subtitle {
            font-size: 18px;
            color: rgba(255,255,255,0.9);
            margin-bottom: 30px;
            font-weight: 500;
        }

        .btn-primary {
            background: linear-gradient(135deg, #FF4757 0%, #FF3838 100%);
            color: white;
            border: none;
            padding: 18px 60px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            margin: 10px;
            box-shadow: 0 8px 25px rgba(255,71,87,0.5);
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(255,71,87,0.7);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            padding: 15px 50px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            margin: 10px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.5);
        }

        /* è§’è‰²é€‰æ‹©é¡µ */
        #select-page {
            background: linear-gradient(135deg, #FFE5EC 0%, #FFF5F7 100%);
            padding: 20px;
        }

        .page-header {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px 0;
        }

        .back-btn {
            position: absolute;
            left: 20px;
            background: none;
            border: none;
            font-size: 24px;
            color: #FF6B9D;
            cursor: pointer;
        }

        .page-title {
            font-size: 24px;
            font-weight: bold;
            color: #FF6B9D;
        }

        .cards-container {
            display: flex;
            overflow-x: auto;
            gap: 16px;
            padding: 20px 10px;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
        }

        .cards-container::-webkit-scrollbar {
            display: none;
        }

        .character-card {
            flex: 0 0 280px;
            background: white;
            border-radius: 20px;
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            scroll-snap-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .character-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.15);
        }

        .character-card.selected {
            border: 3px solid #FF6B9D;
            transform: scale(1.02);
        }

        .character-emoji {
            font-size: 80px;
            margin-bottom: 15px;
        }

        .character-name {
            font-size: 22px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .character-quote {
            font-size: 16px;
            color: #999;
            font-style: italic;
        }

        .confirm-btn-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        /* æ¸¸æˆæˆ˜æ–—é¡µ */
        #game-page {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            position: relative;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }

        .blood-bar-container {
            flex: 1;
            margin: 0 15px;
        }

        .blood-bar-bg {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            overflow: hidden;
        }

        .blood-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.3s ease, background 0.3s ease;
            border-radius: 10px;
        }

        .blood-text {
            color: white;
            font-size: 14px;
            margin-top: 5px;
            text-align: center;
        }

        .combo-display {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 48px;
            font-weight: bold;
            color: #FF6B9D;
            text-shadow: 0 0 20px rgba(255,107,157,0.8);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .combo-display.show {
            opacity: 1;
            animation: pulse 0.5s ease;
        }

        .game-area {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .character-display {
            font-size: 150px;
            cursor: pointer;
            transition: transform 0.1s ease;
            filter: drop-shadow(0 10px 30px rgba(0,0,0,0.3));
            position: relative;
        }

        .character-display.hit {
            animation: shake 0.3s ease;
        }

        /* å›¾ç‰‡æ¨¡å¼æ ·å¼ */
        .character-display {
            width: 200px;
            height: 200px;
            position: relative;
        }

        .character-image {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid rgba(255,107,157,0.3);
            transition: all 0.5s ease;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.3));
        }

        .character-display.hit .character-image {
            animation: shake 0.3s ease;
        }

        /* åŠ¨ç‰©å…ƒç´ å åŠ å±‚ */
        .animal-overlay {
            position: absolute;
            pointer-events: none;
            transition: all 0.5s ease;
        }

        /* çŒªé¼»å­ */
        .pig-nose {
            font-size: 40px;
            bottom: 35%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
        }

        /* çŒªè€³æœµ */
        .pig-ear {
            font-size: 50px;
            top: -20px;
            opacity: 0;
        }

        .pig-ear.left {
            left: -10px;
            transform: rotate(-30deg);
        }

        .pig-ear.right {
            right: -10px;
            transform: rotate(30deg);
        }

        /* è…®çº¢ */
        .blush {
            font-size: 30px;
            top: 50%;
            opacity: 0;
        }

        .blush.left {
            left: 10px;
        }

        .blush.right {
            right: 10px;
        }

        /* é˜¶æ®µ2æ•ˆæœ */
        .stage-2 .pig-nose {
            opacity: 1;
        }

        /* é˜¶æ®µ3æ•ˆæœ */
        .stage-3 .pig-nose,
        .stage-3 .pig-ear,
        .stage-3 .blush {
            opacity: 1;
        }

        /* é˜¶æ®µ4æ•ˆæœ - å®Œå…¨å˜æˆåŠ¨ç‰© */
        .stage-4 .character-image {
            border-radius: 50%;
            filter: saturate(0.3) brightness(1.1);
            transform: scale(0.8);
        }

        .stage-4 .animal-overlay {
            opacity: 1;
        }

        /* é’è›™å˜å½¢ */
        .transform-frog .character-image {
            filter: hue-rotate(60deg) saturate(1.5);
        }

        /* çŒªå˜å½¢ */
        .transform-pig .character-image {
            filter: hue-rotate(-20deg) saturate(0.8) brightness(1.1);
        }

        .damage-number {
            position: absolute;
            font-size: 36px;
            font-weight: bold;
            color: #FF6B9D;
            pointer-events: none;
            animation: floatUp 1s ease forwards;
        }

        .attack-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
        }

        .skill-btn {
            background: linear-gradient(135deg, #FF6B9D 0%, #FF4081 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 25px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255,107,157,0.4);
            transition: all 0.3s ease;
        }

        .skill-btn:active {
            transform: scale(0.95);
        }

        .skill-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .speech-bubble {
            position: absolute;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 15px 25px;
            border-radius: 20px;
            font-size: 16px;
            color: #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s ease;
            white-space: nowrap;
        }

        .speech-bubble.show {
            opacity: 1;
        }

        .speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid white;
        }

        /* ç»“æœé¡µ */
        #result-page {
            background: linear-gradient(135deg, #FFE5EC 0%, #FFF5F7 100%);
            align-items: center;
            justify-content: center;
            padding: 30px 20px;
        }

        .result-card {
            background: white;
            border-radius: 30px;
            padding: 40px 30px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            animation: fadeIn 0.8s ease;
        }

        .result-emoji {
            font-size: 100px;
            margin-bottom: 20px;
        }

        .result-title {
            font-size: 28px;
            font-weight: bold;
            color: #FF6B9D;
            margin-bottom: 15px;
        }

        .result-message {
            font-size: 18px;
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .stats-info {
            background: #FFF5F7;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #666;
            font-size: 16px;
        }

        .stat-value {
            color: #FF6B9D;
            font-size: 18px;
            font-weight: bold;
        }

        .result-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 300px;
        }

        /* æµ‹è¯•é¡µ */
        #test-page {
            background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
            padding: 20px;
            align-items: center;
        }

        .test-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .test-question {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 25px;
            text-align: center;
        }

        .test-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .test-option {
            background: #F5F5F5;
            border: 2px solid transparent;
            padding: 15px 20px;
            border-radius: 15px;
            font-size: 16px;
            color: #333;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .test-option:hover {
            background: #E8F5E9;
            border-color: #4CAF50;
        }

        .test-result {
            text-align: center;
        }

        .result-type {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .result-title {
            font-size: 24px;
            font-weight: bold;
            color: #FF6B9D;
            margin-bottom: 15px;
        }

        .result-desc {
            font-size: 16px;
            color: #666;
            line-height: 1.8;
            margin-bottom: 25px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(0,0,0,0.1);
            border-radius: 4px;
            margin-bottom: 25px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- é¦–é¡µ -->
        <div id="home-page" class="page active">
            <!-- èƒŒæ™¯è£…é¥°æ˜Ÿæ˜Ÿ -->
            <div class="home-bg-decoration" id="bgDecoration"></div>

            <!-- å°é¢å›¾åŒºåŸŸ -->
            <div class="hero-cover">
                <!-- æš´æ€’æ¸£ç”· -->
                <div class="knocked-out-character">
                    <!-- æ„¤æ€’ç«ç„° -->
                    <div class="anger-flames" style="top: -15px; left: 20px;">ğŸ”¥</div>
                    <div class="anger-flames" style="top: -15px; right: 20px; animation-delay: 0.2s;">ğŸ”¥</div>
                    <div class="anger-flames" style="bottom: -10px; left: 50%; transform: translateX(-50%); animation-delay: 0.4s;">ğŸ’¢</div>

                    <!-- æ—‹è½¬çœ©æ™•ç¬¦å· -->
                    <div class="swirl-effect">ğŸ’¢</div>

                    <!-- æš´æ€’å›¾ç‰‡ -->
                    <div class="character-body">
                        <img class="character-image" src="/Users/chenpeng/Desktop/æš´æ€’.png" alt="æš´æ€’æ¸£ç”·" onerror="this.src='https://maas-log-prod.cn-wlcb.ufileos.com/anthropic/4b8e014f-ab79-456e-ae47-7a896683c68b/æš´æ€’.png?UCloudPublicKey=TOKEN_e15ba47a-d098-4fbd-9afc-a0dcf0e4e621&Expires=1769081035&Signature=evvDgL22VzlSLuzMhNa+zXBNO5U='">
                    </div>

                    <!-- æ‹³å°è£…é¥° -->
                    <div class="fist-print" style="top: 20px; left: -15px; transform: rotate(-30deg);">ğŸ‘Š</div>
                    <div class="fist-print" style="top: 40px; right: -20px; transform: rotate(25deg);">ğŸ‘Š</div>
                    <div class="fist-print" style="bottom: 10px; left: 5px; transform: rotate(-20deg); font-size: 28px;">ğŸ’¥</div>
                </div>
            </div>

            <!-- æ ‡é¢˜åŒºåŸŸ -->
            <div class="title-section">
                <div class="game-title">èƒ–æå‰ç”·å‹</div>
                <div class="game-subtitle">è§£å‹ç¥å™¨ï¼Œçˆ½åˆ°é£èµ·ï¼ğŸ’ª</div>
            </div>

            <!-- æ“ä½œæŒ‰é’® -->
            <div style="display: flex; flex-direction: column; gap: 15px; padding: 0 40px 40px; z-index: 1;">
                <button class="btn-primary" onclick="showStartModal()">ğŸ‘Š å¼€å§‹èƒ–æ</button>
            </div>
        </div>

        <!-- å¼€å§‹æ¸¸æˆå¼¹çª— -->
        <div class="modal-overlay" id="startModal">
            <div class="modal-content">
                <div class="modal-emoji">ğŸ¤”</div>
                <div class="modal-title">å‡†å¤‡å¥½äº†å—ï¼Ÿ</div>
                <div class="modal-desc">å…ˆæµ‹æµ‹ä½ çš„æ¸£ç”·ç±»å‹ï¼Œç„¶åè‡ªåŠ¨åŒ¹é…å¼€å§‹èƒ–æï¼</div>
                <div class="modal-buttons">
                    <button class="modal-btn modal-btn-primary" onclick="startWithTest()">ğŸ“ å…ˆæµ‹æ¸£ç”·ç±»å‹</button>
                </div>
            </div>
        </div>

        <!-- è§’è‰²é€‰æ‹©é¡µ -->
        <div id="select-page" class="page">
            <div class="page-header">
                <button class="back-btn" onclick="showHomePage()">â†</button>
                <div class="page-title">é€‰æ‹©æ¸£ç”·ç±»å‹</div>
            </div>
            <div class="cards-container" id="cardsContainer"></div>
            <div class="confirm-btn-container">
                <button class="btn-secondary" onclick="showHomePage()">è·³è¿‡</button>
                <button class="btn-primary" onclick="startGame()">ç¡®è®¤é€‰æ‹©</button>
            </div>
        </div>

        <!-- æ¸¸æˆæˆ˜æ–—é¡µ -->
        <div id="game-page" class="page">
            <div class="game-header">
                <span style="color: white; font-size: 24px;">â¸ï¸</span>
                <div class="blood-bar-container">
                    <div class="blood-bar-bg">
                        <div class="blood-bar" id="bloodBar"></div>
                    </div>
                    <div class="blood-text" id="bloodText">100/100</div>
                </div>
            </div>

            <div class="combo-display" id="comboDisplay">è¿å‡» x3!</div>

            <div class="game-area">
                <div class="character-display" id="gameCharacter" onclick="attackCharacter(event)">
                    <img class="character-image" id="characterImage" src="/Users/chenpeng/Desktop/1.jpg" onerror="this.src='https://maas-log-prod.cn-wlcb.ufileos.com/anthropic/4b8e014f-ab79-456e-ae47-7a896683c68b/1.jpg?UCloudPublicKey=TOKEN_e15ba47a-d098-4fbd-9afc-a0dcf0e4e621&Expires=1769082365&Signature=cny/DY6bTQifdkNrxlpn9fM4C9o='" alt="è§’è‰²">
                </div>
                <div class="speech-bubble" id="speechBubble">æˆ‘å¿™...</div>
            </div>

            <div class="attack-buttons">
                <button class="skill-btn" onclick="useSkill('combo')">âš¡ è¿å‡»</button>
                <button class="skill-btn" onclick="useSkill('special')">ğŸ’¥ å¤§æ‹›</button>
            </div>
        </div>

        <!-- ç»“æœé¡µ -->
        <div id="result-page" class="page">
            <div class="result-card">
                <img src="/Users/chenpeng/Desktop/2.png" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid #FF4757; box-shadow: 0 10px 30px rgba(255,71,87,0.5); margin-bottom: 20px;" onerror="this.src='https://maas-log-prod.cn-wlcb.ufileos.com/anthropic/4b8e014f-ab79-456e-ae47-7a896683c68b/2.png?UCloudPublicKey=TOKEN_e15ba47a-d098-4fbd-9afc-a0dcf0e4e621&Expires=1769082365&Signature=aADs3OuYD+UZY+CC0klrx6bR5ZM='">
                <div class="result-title">åŸè°…ä»–å§</div>
                <div class="result-message">ä»–æ¯æ—¶æ¯åˆ»éƒ½åœ¨æƒ³ä½ â¤ï¸</div>
            </div>

            <div style="display: flex; flex-direction: column; gap: 15px; width: 100%; max-width: 300px;">
                <button class="btn-primary" onclick="showHomePage()">å¥½çš„</button>
            </div>
        </div>

        <!-- æµ‹è¯•é¡µ -->
        <div id="test-page" class="page">
            <div class="page-header">
                <button class="back-btn" onclick="showHomePage()">â†</button>
                <div class="page-title">æ¸£ç”·ç±»å‹æµ‹è¯•</div>
            </div>
            <div class="test-card" id="testCard">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 20%"></div>
                </div>
                <div id="testContent"></div>
            </div>
        </div>
    </div>

    <script>
        // éŸ³æ•ˆç³»ç»Ÿ
        class SoundManager {
            constructor() {
                this.audioContext = null;
                this.enabled = true;
            }

            init() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.warn('Web Audio API not supported');
                    this.enabled = false;
                }
            }

            playTone(frequency, duration, type = 'sine') {
                if (!this.enabled || !this.audioContext) return;

                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);

                oscillator.frequency.value = frequency;
                oscillator.type = type;

                gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);

                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }

            playHit() {
                this.playTone(300, 0.1, 'square');
            }

            playCombo() {
                this.playTone(500, 0.15, 'sawtooth');
            }

            playSpecial() {
                this.playTone(200, 0.3, 'square');
                setTimeout(() => this.playTone(400, 0.3, 'square'), 100);
            }

            playWin() {
                const notes = [523, 659, 784, 1047];
                notes.forEach((note, i) => {
                    setTimeout(() => this.playTone(note, 0.3, 'sine'), i * 150);
                });
            }

            playClick() {
                this.playTone(800, 0.05, 'sine');
            }
        }

        const soundManager = new SoundManager();

        // æ¸¸æˆæ•°æ®
        const characters = [
            { id: 1, name: 'å†·æš´åŠ›æ¸£ç”·', emoji: 'ğŸ’€', quote: 'æˆ‘å¿™...', quotes: ['æˆ‘å¿™...', 'ä½ æƒ³å¤šäº†', 'åˆ«é—¹'] },
            { id: 2, name: 'å‡ºè½¨æ¸£ç”·', emoji: 'ğŸ”¥', quote: 'åªæ˜¯æœ‹å‹', quotes: ['åªæ˜¯æœ‹å‹', 'ä½ æƒ³å¤šäº†', 'ç›¸ä¿¡æˆ‘'] },
            { id: 3, name: 'æŠ é—¨æ¸£ç”·', emoji: 'ğŸ’°', quote: 'å¤ªè´µäº†', quotes: ['å¤ªè´µäº†', 'æ²¡å¿…è¦', 'çœç€ç‚¹'] },
            { id: 4, name: 'æ’’è°æ¸£ç”·', emoji: 'ğŸ­', quote: 'çœŸçš„ï¼', quotes: ['çœŸçš„ï¼', 'æˆ‘å‘èª“', 'æ²¡éª—ä½ '] },
            { id: 5, name: 'å¦ˆå®æ¸£ç”·', emoji: 'ğŸ‘»', quote: 'æˆ‘å¦ˆè¯´...', quotes: ['æˆ‘å¦ˆè¯´...', 'é—®é—®æˆ‘å¦ˆ', 'å¬æˆ‘å¦ˆçš„'] },
            { id: 6, name: 'æ— ç¼è¡”æ¥æ¸£ç”·', emoji: 'ğŸ’”', quote: 'æˆ‘ä»¬åªæ˜¯åŒäº‹', quotes: ['åªæ˜¯åŒäº‹', 'æ™®é€šæœ‹å‹', 'ä½ æƒ³å¤šäº†'] }
        ];

        const testQuestions = [
            {
                question: 'ä½ çš„å‰ä»»æœ€å¸¸è¯´çš„æ˜¯ï¼Ÿ',
                options: ['A. æˆ‘å¿™', 'B. ä½ æ— ç†å–é—¹', 'C. éƒ½æ˜¯ä½ çš„é”™']
            },
            {
                question: 'åˆ†æ‰‹æ—¶ä»–çš„ååº”æ˜¯ï¼Ÿ',
                options: ['A. å†·æš´åŠ›', 'B. ç«‹åˆ»æœ‰æ–°æ¬¢', 'C. ç—›å“­æµæ¶•']
            },
            {
                question: 'ä½ æœ€æƒ³å¯¹ä»–è¯´ä»€ä¹ˆï¼Ÿ',
                options: ['A. æ»š!', 'B. ç¥ä½ å¹¸ç¦', 'C. ä¸ºä»€ä¹ˆ?']
            },
            {
                question: 'å¦‚æœæœ‰æœºä¼šï¼Œä½ ä¼šï¼Ÿ',
                options: ['A. æä»–', 'B. éª‚ä»–', 'C. æ— è§†ä»–']
            },
            {
                question: 'ä½ ç°åœ¨çš„å¿ƒæƒ…æ˜¯ï¼Ÿ',
                options: ['A. æ„¤æ€’', 'B. ä¸ç”˜å¿ƒ', 'C. é‡Šæ€€']
            }
        ];

        const testResults = [
            { type: 'å†·æš´åŠ›å‹å—å®³è€…', emoji: 'ğŸ’€', title: 'å†·æš´åŠ›å‹å—å®³è€…', desc: 'ä½ é‡åˆ°äº†å…¸å‹çš„å†·æš´åŠ›æ¸£ç”·ï¼ä»–æ€»æ˜¯å¿½å†·å¿½çƒ­ï¼Œè®©ä½ æ‚£å¾—æ‚£å¤±ã€‚è®°ä½ï¼Œå¥½çš„æ„Ÿæƒ…éœ€è¦åŒå‘å¥”èµ´ï¼Œä¸å€¼å¾—çš„äººå°±è®©ä»–æ»šè›‹ï¼' },
            { type: 'ç†æ™ºå¥³ç‹', emoji: 'ğŸ‘‘', title: 'ç†æ™ºå¥³ç‹', desc: 'ä½ éå¸¸ç†æ™ºï¼Œèƒ½å¤Ÿå†·é™å¤„ç†æ„Ÿæƒ…é—®é¢˜ã€‚å³ä½¿åœ¨åˆ†æ‰‹æ—¶ä¹Ÿèƒ½ä¿æŒä½“é¢ã€‚è¿™ç§æ€åº¦éå¸¸æ£’ï¼Œä½ å€¼å¾—æ›´å¥½çš„äººï¼' },
            { type: 'æ·±æƒ…å°å…”', emoji: 'ğŸ°', title: 'æ·±æƒ…å°å…”', desc: 'ä½ æ˜¯ä¸€ä¸ªæ·±æƒ…çš„äººï¼Œå®¹æ˜“å¯¹æ„Ÿæƒ…æŠ•å…¥çœŸå¿ƒã€‚è™½ç„¶å—è¿‡ä¼¤ï¼Œä½†ä¾ç„¶ç›¸ä¿¡çˆ±æƒ…ã€‚ä¿æŒè¿™ä»½çº¯çœŸï¼Œå¯¹çš„äººæ­£åœ¨è·¯ä¸Šï¼' }
        ];

        // æ¸¸æˆçŠ¶æ€
        let selectedCharacter = characters[0];
        let blood = 100;
        let maxBlood = 100;
        let attackCount = 0;
        let comboCount = 0;
        let maxCombo = 0;
        let lastAttackTime = 0;
        let currentTestQuestion = 0;
        let testAnswers = [];

        // åˆå§‹åŒ–è§’è‰²å¡ç‰‡
        function initCharacterCards() {
            const container = document.getElementById('cardsContainer');
            container.innerHTML = characters.map(char => `
                <div class="character-card ${char.id === selectedCharacter.id ? 'selected' : ''}"
                     onclick="selectCharacter(${char.id})">
                    <div class="character-emoji">${char.emoji}</div>
                    <div class="character-name">${char.name}</div>
                    <div class="character-quote">${char.quote}</div>
                </div>
            `).join('');
        }

        // é€‰æ‹©è§’è‰²
        function selectCharacter(id) {
            selectedCharacter = characters.find(c => c.id === id);
            initCharacterCards();
        }

        // é¡µé¢åˆ‡æ¢
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }

        function showHomePage() {
            showPage('home-page');
        }

        function showSelectPage() {
            initCharacterCards();
            showPage('select-page');
        }

        function showTestPage() {
            currentTestQuestion = 0;
            testAnswers = [];
            showTestQuestion();
            showPage('test-page');
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            soundManager.init();
            blood = maxBlood;
            attackCount = 0;
            comboCount = 0;
            maxCombo = 0;

            // é‡ç½®ä¸ºå›¾ç‰‡1
            const charImage = document.getElementById('characterImage');
            charImage.src = '/Users/chenpeng/Desktop/1.jpg';
            charImage.onerror = function() {
                this.src = 'https://maas-log-prod.cn-wlcb.ufileos.com/anthropic/4b8e014f-ab79-456e-ae47-7a896683c68b/1.jpg?UCloudPublicKey=TOKEN_e15ba47a-d098-4fbd-9afc-a0dcf0e4e621&Expires=1769082365&Signature=cny/DY6bTQifdkNrxlpn9fM4C9o=';
            };

            updateBloodBar();
            showPage('game-page');

            // æ˜¾ç¤ºåˆå§‹å¯¹è¯
            showSpeech(selectedCharacter.quote);
        }

        // æ›´æ–°è¡€æ¡
        function updateBloodBar() {
            const percentage = (blood / maxBlood) * 100;
            const bloodBar = document.getElementById('bloodBar');
            const bloodText = document.getElementById('bloodText');

            bloodBar.style.width = percentage + '%';

            if (percentage > 60) {
                bloodBar.style.background = 'linear-gradient(90deg, #4CAF50, #8BC34A)';
            } else if (percentage > 30) {
                bloodBar.style.background = 'linear-gradient(90deg, #FF9800, #FFC107)';
            } else {
                bloodBar.style.background = 'linear-gradient(90deg, #F44336, #FF5722)';
            }

            bloodText.textContent = `${blood}/${maxBlood}`;
        }

        // æ›´æ–°è§’è‰²æ˜¾ç¤º
        function updateCharacter() {
            const charDisplay = document.getElementById('gameCharacter');
            charDisplay.textContent = selectedCharacter.emoji;
        }

        // æ˜¾ç¤ºå¯¹è¯
        function showSpeech(text) {
            const bubble = document.getElementById('speechBubble');
            bubble.textContent = text;
            bubble.classList.add('show');

            setTimeout(() => {
                bubble.classList.remove('show');
            }, 2000);
        }

        // æ”»å‡»è§’è‰²
        function attackCharacter(event) {
            const now = Date.now();

            // è¿å‡»åˆ¤å®š
            if (now - lastAttackTime < 500) {
                comboCount++;
                if (comboCount > maxCombo) {
                    maxCombo = comboCount;
                }
            } else {
                comboCount = 1;
            }

            lastAttackTime = now;

            // è®¡ç®—ä¼¤å®³
            const damage = comboCount >= 3 ? 2 : 1;
            blood -= damage;
            attackCount++;

            // è§†è§‰åé¦ˆ
            const charDisplay = document.getElementById('gameCharacter');
            charDisplay.classList.add('hit');
            setTimeout(() => charDisplay.classList.remove('hit'), 300);

            // æ’­æ”¾éŸ³æ•ˆ
            soundManager.playHit();

            // æ˜¾ç¤ºä¼¤å®³æ•°å­—
            showDamageNumber(event, damage);

            // æ˜¾ç¤ºè¿å‡»
            if (comboCount >= 3) {
                showCombo(comboCount);
            }

            // æ›´æ–°è¡€æ¡
            updateBloodBar();

            // éšæœºæ˜¾ç¤ºå¯¹è¯
            if (Math.random() > 0.7) {
                const randomQuote = selectedCharacter.quotes[Math.floor(Math.random() * selectedCharacter.quotes.length)];
                showSpeech(randomQuote);
            }

            // æ£€æŸ¥æ¸¸æˆç»“æŸ
            if (blood <= 0) {
                blood = 0;
                updateBloodBar();
                setTimeout(endGame, 500);
            }

            // éœ‡åŠ¨åé¦ˆ
            if (navigator.vibrate) {
                navigator.vibrate(10);
            }
        }

        // æ˜¾ç¤ºä¼¤å®³æ•°å­—
        function showDamageNumber(event, damage) {
            const gameArea = document.querySelector('.game-area');
            const damageNum = document.createElement('div');
            damageNum.className = 'damage-number';
            damageNum.textContent = `-${damage}`;
            damageNum.style.left = (event.clientX - gameArea.getBoundingClientRect().left) + 'px';
            damageNum.style.top = (event.clientY - gameArea.getBoundingClientRect().top) + 'px';
            gameArea.appendChild(damageNum);

            setTimeout(() => damageNum.remove(), 1000);
        }

        // æ˜¾ç¤ºè¿å‡»
        function showCombo(combo) {
            const comboDisplay = document.getElementById('comboDisplay');
            comboDisplay.textContent = `è¿å‡» x${combo}!`;
            comboDisplay.classList.add('show');

            setTimeout(() => {
                comboDisplay.classList.remove('show');
            }, 500);
        }

        // ä½¿ç”¨æŠ€èƒ½
        function useSkill(type) {
            if (type === 'combo') {
                const damage = 5;
                blood -= damage;
                attackCount += 5;
                showCombo(5);
                showSpeech('å•Šï¼ï¼ï¼');
                soundManager.playCombo();

                if (navigator.vibrate) {
                    navigator.vibrate(30);
                }
            } else if (type === 'special') {
                const damage = 10;
                blood -= damage;
                attackCount += 10;
                showSpeech('æˆ‘é”™äº†ï¼ï¼ï¼');
                soundManager.playSpecial();

                if (navigator.vibrate) {
                    navigator.vibrate([50, 50, 50]);
                }
            }

            updateBloodBar();

            if (blood <= 0) {
                blood = 0;
                updateBloodBar();
                setTimeout(endGame, 500);
            }
        }

        // æ¸¸æˆç»“æŸ
        function endGame() {
            soundManager.playWin();

            // å°†å›¾ç‰‡å˜æˆè¢«æåçš„æ ·å­
            const charImage = document.getElementById('characterImage');
            charImage.src = '/Users/chenpeng/Desktop/2.png';
            charImage.onerror = function() {
                this.src = 'https://maas-log-prod.cn-wlcb.ufileos.com/anthropic/4b8e014f-ab79-456e-ae47-7a896683c68b/2.png?UCloudPublicKey=TOKEN_e15ba47a-d098-4fbd-9afc-a0dcf0e4e621&Expires=1769082365&Signature=aADs3OuYD+UZY+CC0klrx6bR5ZM=';
            };

            // å»¶è¿Ÿä¸€ä¸‹æ˜¾ç¤ºç»“æœé¡µ
            setTimeout(() => {
                showPage('result-page');
            }, 1000);
        }

        // åˆ†äº«ç»“æœ
        function shareResult() {
            const text = `æˆ‘åœ¨ã€Šå¤±æ‹åå‡»æˆ˜ã€‹ä¸­æš´æäº†${selectedCharacter.name}${attackCount}æ¬¡ï¼Œæœ€é«˜${maxCombo}è¿å‡»ï¼ä½ ä¹Ÿæ¥è¯•è¯•å§ï¼`;

            if (navigator.share) {
                navigator.share({
                    title: 'å¤±æ‹åå‡»æˆ˜',
                    text: text,
                    url: window.location.href
                }).catch(() => {
                    alert('åˆ†äº«å†…å®¹ï¼š\n' + text);
                });
            } else {
                alert('åˆ†äº«å†…å®¹ï¼š\n' + text);
            }
        }

        // æ˜¾ç¤ºæµ‹è¯•é—®é¢˜
        function showTestQuestion() {
            const content = document.getElementById('testContent');
            const progressFill = document.getElementById('progressFill');

            if (currentTestQuestion < testQuestions.length) {
                const q = testQuestions[currentTestQuestion];
                progressFill.style.width = ((currentTestQuestion + 1) / testQuestions.length * 100) + '%';

                content.innerHTML = `
                    <div class="test-question">${q.question}</div>
                    <div class="test-options">
                        ${q.options.map((opt, i) => `
                            <button class="test-option" onclick="answerTest(${i})">${opt}</button>
                        `).join('')}
                    </div>
                `;
            } else {
                showTestResult();
            }
        }

        // ç›´æ¥ä»æ¸¸æˆè¿›å…¥æµ‹è¯•ï¼ˆè·³è¿‡é€‰æ‹©é¡µï¼‰
        function startWithTest() {
            closeModal();
            currentTestQuestion = 0;
            testAnswers = [];
            showTestQuestion();
            showPage('test-page');
        }

        // æ˜¾ç¤ºå¼€å§‹å¼¹çª—
        function showStartModal() {
            document.getElementById('startModal').classList.add('show');
        }

        // å…³é—­å¼¹çª—
        function closeModal() {
            document.getElementById('startModal').classList.remove('show');
        }

        // å›ç­”é—®é¢˜
        function answerTest(index) {
            testAnswers.push(index);
            currentTestQuestion++;
            showTestQuestion();
        }

        // æ˜¾ç¤ºæµ‹è¯•ç»“æœ
        function showTestResult() {
            const content = document.getElementById('testContent');
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = '100%';

            // æ ¹æ®ç­”æ¡ˆè®¡ç®—æ¸£ç”·ç±»å‹
            const score = testAnswers.reduce((a, b) => a + b, 0);

            // æ˜ å°„åˆ†æ•°åˆ°æ¸£ç”·ç±»å‹
            let characterId;
            if (score <= 3) {
                characterId = 1; // å†·æš´åŠ›æ¸£ç”·
            } else if (score <= 6) {
                characterId = 2; // å‡ºè½¨æ¸£ç”·
            } else if (score <= 8) {
                characterId = 3; // æŠ é—¨æ¸£ç”·
            } else if (score <= 10) {
                characterId = 4; // æ’’è°æ¸£ç”·
            } else {
                characterId = 5; // å¦ˆå®æ¸£ç”·
            }

            const matchedCharacter = characters.find(c => c.id === characterId);

            // é€‰æ‹©å¯¹åº”çš„æ¸£ç”·ç±»å‹
            selectedCharacter = matchedCharacter;

            content.innerHTML = `
                <div class="test-result">
                    <img src="/Users/chenpeng/Desktop/1.jpg" style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 5px solid #FF4757; box-shadow: 0 10px 30px rgba(255,71,87,0.5); margin-bottom: 20px;" onerror="this.src='https://maas-log-prod.cn-wlcb.ufileos.com/anthropic/4b8e014f-ab79-456e-ae47-7a896683c68b/1.jpg?UCloudPublicKey=TOKEN_e15ba47a-d098-4fbd-9afc-a0dcf0e4e621&Expires=1769082365&Signature=cny/DY6bTQifdkNrxlpn9fM4C9o='">
                    <div class="result-title">${matchedCharacter.name}</div>
                    <div class="result-desc" style="text-align: center; font-size: 16px;">
                        "${matchedCharacter.quote}"<br><br>
                        å¿«å»èƒ–æä»–å§ï¼
                    </div>
                    <button class="btn-primary" onclick="goToSelectedCharacter()">ğŸ‘Š å»èƒ–æä»–</button>
                </div>
            `;
        }

        // è·³è½¬åˆ°é€‰ä¸­çš„æ¸£ç”·å¡ç‰‡
        function goToSelectedCharacter() {
            // ç›´æ¥å¼€å§‹æ¸¸æˆï¼Œä¸ç»è¿‡é€‰æ‹©é¡µé¢
            startGame();
        }

        // åˆ†äº«æµ‹è¯•ç»“æœ
        function shareTestResult(result) {
            const text = `æµ‹å‡ºæˆ‘çš„æ¸£ç”·ç±»å‹æ˜¯ï¼š${result}ï¼ä½ ä¹Ÿæ¥æµ‹æµ‹å§ï¼`;

            if (navigator.share) {
                navigator.share({
                    title: 'æ¸£ç”·ç±»å‹æµ‹è¯•',
                    text: text,
                    url: window.location.href
                }).catch(() => {
                    alert('åˆ†äº«å†…å®¹ï¼š\n' + text);
                });
            } else {
                alert('åˆ†äº«å†…å®¹ï¼š\n' + text);
            }
        }

        // åˆå§‹åŒ–
        initCharacterCards();

        // ç”ŸæˆèƒŒæ™¯è£…é¥°æ˜Ÿæ˜Ÿ
        function generateBackgroundStars() {
            const container = document.getElementById('bgDecoration');
            if (!container) return;

            const emojis = ['ğŸ”¥', 'ğŸ’¢', 'ğŸ’¥', 'âœ¨', 'ğŸ’«', 'ğŸ‘Š'];
            for (let i = 0; i < 15; i++) {
                const star = document.createElement('div');
                star.className = 'floating-star';
                star.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                star.style.animationDuration = (3 + Math.random() * 2) + 's';
                container.appendChild(star);
            }
        }

        // é¡µé¢åŠ è½½æ—¶ç”ŸæˆèƒŒæ™¯æ˜Ÿæ˜Ÿ
        generateBackgroundStars();
    </script>
</body>
</html>
