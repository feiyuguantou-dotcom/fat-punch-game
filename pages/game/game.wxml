<!--pages/game/game.wxml-->
<view class="page">
  <!-- é€‰æ‹©æ¸£ç”·ç±»å‹ç•Œé¢ -->
  <view class="select-screen" wx:if="{{gameState === 'select'}}">
    <view class="header">
      <view class="header-title">é€‰æ‹©è®©ä½ æœ€ä¸çˆ½çš„ç±»å‹</view>
      <view class="header-subtitle">é€‰æ‹©åå¼€å§‹æš´æ</view>
    </view>

    <!-- æ¸£ç”·ç±»å‹å¡ç‰‡ -->
    <scroll-view class="character-scroll" scroll-x="{{true}}" show-scrollbar="{{false}}">
      <view class="character-list">
        <view
          class="character-card {{selectedCharacter === item.id ? 'active' : ''}}"
          wx:for="{{characterTypes}}"
          wx:key="id"
          bindtap="selectCharacter"
          data-id="{{item.id}}"
        >
          <view class="character-emoji">{{item.emoji}}</view>
          <view class="character-name">{{item.name}}</view>
          <view class="character-tagline">{{item.tagline}}</view>
          <view class="card-mask" wx:if="{{selectedCharacter === item.id}}"></view>
          <view class="card-check" wx:if="{{selectedCharacter === item.id}}">âœ“</view>
        </view>
      </view>
    </scroll-view>

    <!-- è¯¦ç»†ä¿¡æ¯ -->
    <view class="character-detail" wx:if="{{selectedCharacterInfo}}">
      <view class="detail-title">{{selectedCharacterInfo.name}}</view>
      <view class="detail-desc">{{selectedCharacterInfo.description}}</view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <button class="action-btn skip-btn" bindtap="skipSelect">è·³è¿‡</button>
      <button class="action-btn confirm-btn" bindtap="confirmSelect">ç¡®è®¤é€‰æ‹©,å¼€å§‹</button>
    </view>
  </view>

  <!-- æ¸¸æˆæˆ˜æ–—ç•Œé¢ -->
  <view class="battle-screen" wx:if="{{gameState === 'battle'}}">
    <!-- HUDä¿¡æ¯æ  -->
    <view class="hud-bar">
      <view class="hud-left">
        <view class="pause-btn" bindtap="pauseGame">â¸ï¸</view>
      </view>
      <view class="hud-center">
        <view class="blood-text">è¡€é‡: {{blood}}/{{maxBlood}}</view>
      </view>
      <view class="hud-right">
        <view class="combo-display" wx:if="{{combo > 2}}">
          <text class="combo-number">è¿å‡» x{{combo}}!</text>
        </view>
      </view>
    </view>

    <!-- æ¸¸æˆåŒºåŸŸ -->
    <view class="game-area" bindtap="handleAttack" bindtouchstart="handleTouchStart" bindtouchend="handleTouchEnd">
      <!-- æ¸£ç”·å½¢è±¡ -->
      <view class="character-container">
        <view class="character {{characterShaking ? 'shake' : ''}} {{characterTransforming ? 'transform' : ''}}" style="transform: scale({{characterScale}})">
          <view class="character-emoji-large">{{currentCharacter.emoji}}</view>
          <!-- å˜èº«åçš„å½¢è±¡ -->
          <view class="transformed-character" wx:if="{{transformedType}}">
            <text class="transformed-emoji">{{transformedEmoji}}</text>
          </view>
        </view>

        <!-- è¡€æ¡ -->
        <view class="blood-bar-container">
          <view class="blood-bar-bg">
            <view class="blood-bar-fill" style="width: {{bloodPercentage}}%; background: {{bloodColor}};"></view>
          </view>
          <view class="blood-text">{{blood}}/{{maxBlood}}</view>
        </view>

        <!-- ä¼¤å®³æ•°å­—æ˜¾ç¤º -->
        <view class="damage-numbers">
          <view
            class="damage-number {{item.isCritical ? 'critical' : ''}}"
            wx:for="{{damageNumbers}}"
            wx:key="id"
            style="left: {{item.x}}rpx; top: {{item.y}}rpx; opacity: {{item.opacity}};"
          >
            -{{item.damage}}
          </view>
        </view>
      </view>

      <!-- è¿å‡»æç¤º -->
      <view class="combo-hint" wx:if="{{showComboHint}}">
        <view class="combo-text">{{comboHintText}}</view>
      </view>

      <!-- æ”»å‡»ç‰¹æ•ˆç²’å­ -->
      <view class="particles">
        <view
          class="particle"
          wx:for="{{particles}}"
          wx:key="id"
          style="left: {{item.x}}rpx; top: {{item.y}}rpx; opacity: {{item.opacity}};"
        >
          {{item.icon}}
        </view>
      </view>
    </view>

    <!-- è“„åŠ›æ¡ -->
    <view class="charge-bar-container" wx:if="{{showChargeBar}}">
      <view class="charge-bar-bg">
        <view class="charge-bar-fill" style="width: {{chargeProgress}}%;"></view>
      </view>
      <view class="charge-text">è“„åŠ›ä¸­...</view>
    </view>

    <!-- æŠ€èƒ½æŒ‰é’® -->
    <view class="skill-panel">
      <view class="skill-item" bindtap="useSkill" data-skill="combo">
        <view class="skill-icon">âš¡</view>
        <view class="skill-name">é—ªç”µäº”è¿é­</view>
        <view class="skill-cd" wx:if="{{skillCD.combo > 0}}">{{skillCD.combo}}s</view>
      </view>
      <view class="skill-item" bindtap="useSkill" data-skill="truth">
        <view class="skill-icon">ğŸ’£</view>
        <view class="skill-name">çœŸå¿ƒè¯ç‚¸å¼¹</view>
        <view class="skill-lock" wx:if="{{!skillUnlocked.truth}}">ğŸ”’</view>
      </view>
      <view class="skill-item" bindtap="useSkill" data-skill="transform">
        <view class="skill-icon">ğŸ¸</view>
        <view class="skill-name">å˜å½¢æœ¯</view>
        <view class="skill-lock" wx:if="{{!skillUnlocked.transform}}">ğŸ’°</view>
      </view>
    </view>

    <!-- æ¸£ç”·å°è¯ -->
    <view class="character-dialog" wx:if="{{showDialog}}">
      <view class="dialog-bubble">
        {{dialogText}}
      </view>
    </view>
  </view>

  <!-- æš‚åœå¼¹çª— -->
  <view class="pause-modal" wx:if="{{isPaused}}">
    <view class="modal-mask" bindtap="resumeGame"></view>
    <view class="modal-content">
      <view class="modal-title">æ¸¸æˆæš‚åœ</view>
      <view class="modal-buttons">
        <button class="modal-btn secondary" bindtap="resumeGame">ç»§ç»­æ¸¸æˆ</button>
        <button class="modal-btn primary" bindtap="exitGame">é€€å‡ºæ¸¸æˆ</button>
      </view>
    </view>
  </view>
</view>
